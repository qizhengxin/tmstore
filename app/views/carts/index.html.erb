<div class="container">


<div class="row">
  <div class="col-md-12">

    <%= link_to("清空购物车", clean_carts_path, method: :delete, class: "btn btn-default pull-right",
                     style: "text-decoration: underline;", data: { confirm: "确定要清空吗"}) %>
    <h2>购物车</h2>

   <table class="table table-bordered">
    <thead>
        <tr>
            <th colspan="2"> 商品图片 </th>
            <th> 价格 </th>
            <th> 数量 </th>
            <th> 操作 </th>
        </tr>
    </thead>
    <tbody>
       <% current_cart.cart_items.each do |cart_item| %>
         <!-- 找到当前购物车买的的所有东西 把它们每一个拿出来 放到|cart_item|里 每个都做一遍 -->
        <tr>
         <td>
           <%= link_to product_path(cart_item.product) do %>
           <% if cart_item.product.photos[0].present? %>
           <%= image_tag(cart_item.product.photos[0].avatar.thumb.url, class: "thumbnail")  %>
           <% else %>
           <%= image_tag("http://placehold.it/200x200&text=No Pic", class: "thumbnail") %>
           <% end %>
          <% end %>
         </td>

         <td><%= link_to(cart_item.product.title, product_path(cart_item.product)) %></td>
                                                         <!-- 括号里(cart_item.product)是对应上边|cart_item| -->
                                                         <!-- 进入到show页面去找商品 比如一共有三个 先去找第一个产品 -->
         <td><%= cart_item.product.price %></td>

          <td>

              <% cart_item = current_cart.cart_items.find_by(product_id: cart_item.product_id) %>

              <%= form_for cart_item, url: cart_item_path(cart_item.product_id) do |f| %>
              <%= f.select :quantity, 1..cart_item.product.quantity %>
              <%= f.submit "更新", data: { disable_with: "Submitting..." } %>
              <% end %>
          </td>


         <td><%= link_to cart_item_path(cart_item.product_id), method: :delete do %>
           <i class="fa fa-trash"></i>
            <% end %>
         </td>
       </tr>
       <% end %>
    </tbody>
   </table>

    <br>
     <div class="total clearfix">
       <span class="pull-right">
         <span>总计 <%= render_cart_total_price(current_cart) %> RMB</span>
       </span>
     </div>
    <hr>
     <div class="checkout clearfix">
       <%= link_to("确认结账", checkout_carts_path, method: :post, class: "btn btn-lg btn-danger pull-right" ) %>
     </div>

  </div>
 </div>
</div>
